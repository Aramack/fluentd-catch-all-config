<source>
  @type tail
  format json
  path /var/log/gitlab/gitlab-rails/production_json.log,/home/git/gitlab/log/production_json.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-production-json.pos
  read_from_head true
  tag gitlab-production-json
</source>

<source>
  @type tail
  format none
  path /var/log/gitlab/gitlab-rails/production.log,/home/git/gitlab/log/production.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-production.pos
  read_from_head true
  tag gitlab-production
</source>

<source>
  @type tail
  format json
  path /var/log/gitlab/gitlab-rails/api_json.log,/home/git/gitlab/log/api_json.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-api-json.pos
  read_from_head true
  tag gitlab-api-json
</source>

<source>
  @type tail
  # Due to the timestamp in the log only being precise enough to capture logs
  # by the minute, we will not structure these logs.
  # 
  # Sample format
  # November 16, 2017 17:02: User "Administrator" (admin@example.com) was created
  format none
  path /var/log/gitlab/gitlab-rails/application.log,/home/git/gitlab/log/application.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-application.pos
  read_from_head true
  tag gitlab-application
</source>

<source>
  @type tail
  format none
  path /var/log/gitlab/gitlab-rails/githost.log,/home/git/gitlab/log/githost.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-githost.pos
  read_from_head true
  tag gitlab-githost
</source>

<source>
  @type tail
  # Sample format
  # 2014-06-10T07:55:20Z 2037 TID-tm504 ERROR: /opt/bitnami/apps/discourse/htdocs/vendor/bundle/ruby/1.9.1/gems/redis-3.0.7/lib/redis/client.rb:228:in `read'
  format /^[^\s]+\s+(?<time>[^\s]+)\s+(?<pid>\d+)\s+(?<tid>[^\s]+)\s+(?<level>[^:]+):\s+(?<message>.*)$/
  path /var/log/gitlab/gitlab-rails/sidekiq.log,/home/git/gitlab/log/sidekiq.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-sidekiq.pos
  read_from_head true
  tag gitlab-sidekiq
</source>

<source>
  @type tail
  # Sample format
  # I, [2015-02-13T06:17:00.671315 #9291]  INFO -- : Adding project root/example.git at </var/opt/gitlab/git-data/repositories/root/dcdcdcdcd.git>.
  format /^\w,\s+\[(?<time>[^\s]+)\s+#(?<pid>\d+)\]\s+(?<level>\w+)[^:]+:\s+(?<message>.*)$/
  path /var/log/gitlab/gitlab-shell/gitlab-shell.log,/home/git/gitlab-shell/gitlab-shell.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-shell.pos
  read_from_head true
  tag gitlab-shell
</source>

<source>
  @type tail
  format none
  path /var/log/gitlab/unicorn/unicorn_stdout.log,/home/git/gitlab/log/unicorn.stdout.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-unicorn-stdout.pos
  read_from_head true
  tag gitlab-unicorn-stdout
</source>

<source>
  @type tail
  # Sample format
  # I, [2015-02-13T06:14:46.680381 #9047]  INFO -- : Refreshing Gem list
  format /^\w,\s+\[(?<time>[^\s]+)\s+#(?<pid>\d+)\]\s+(?<level>\w+)[^:]+:\s+(?<message>.*)$/
  path /var/log/gitlab/unicorn/unicorn_stderr.log,/home/git/gitlab/log/unicorn.stderr.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-unicorn-stderr.pos
  read_from_head true
  tag gitlab-unicorn-stderr
</source>

<source>
  @type tail
  format none
  path /var/log/gitlab/gitlab-rails/repocheck.log,/home/git/gitlab/log/repocheck.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-unicorn-stderr.pos
  read_from_head true
  tag gitlab-repocheck
</source>

<source>
  @type tail
  format none
  path /var/log/gitlab/gitlab-rails/satellites.log,/home/git/gitlab/log/satellites.log,
  pos_file /var/lib/google-fluentd/pos/gitlab-satellites.pos
  read_from_head true
  tag gitlab-satellites
</source>

# TODO: Add a tag rewriter?
